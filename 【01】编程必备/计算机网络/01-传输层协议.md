> 当前位置：【01】编程必备 -> 计算机网络 -> 01-传输层协议



# 第一章 TCP 协议

## 1、TCP 概念

- TCP（Transport Control Protocol）是一个传输层协议，提供 Host-To-Host 数据的可靠传输，支持全双工，是一个连接导向的协议。



## 2、TCP 可靠性

- 可靠性指数据保证无损传输。
- 如果发送方按照顺序发送，然后数据无序地在网络间传递，就必须有一种算法在接收方将数据恢复原有的顺序。
- 另外，如果发送方同时要把消息发送给多个接收方，这种情况叫作==多播==，可靠性要求每个接收方都无损收到相同的副本。多播情况还有强可靠性，就是如果有一个消息到达任何一个接收者，那么所有接受者都必须收到这个消息。



## 3、TCP 的握手和挥手

- TCP 是一个连接导向的协议，设计有建立连接（握手）和断开连接（挥手）的过程。
- TCP ==没有设计会话（Session）==，因为会话通常是一个应用的行为。



### 3.1 TCP 协议的基本操作

- 如果一个 Host 主动向另一个 Host 发起连接，称为 ==SYN==（Synchronization），==请求同步==

- 如果一个 Host 主动断开请求，称为 ==FIN==（Finish），==请求完成==
- 如果一个 Host 给另一个 Host 发送数据，称为 ==PSH==（Push），==数据推送==

- 以上 3 种情况，接收方收到数据后，都需要给发送方一个==ACK（Acknowledgement）响应==。请求/响应的模型是可靠性的要求，如果一个请求没有响应，发送方可能会认为自己需要重发这个请求。



### 3.2 建立连接的过程（三次握手）

- 第一次握手
  - 客户端发消息给服务端（SYN）

服务端准备好进行连接

- 第二次握手
  - 服务端针对客户端的 SYN 给一个 ACK
  - 服务端发送一个 SYN 给客户端

客户端准备就绪

- 第三次握手
  - 客户端给服务端发送一个 ACK

![Snip20210812_73](image/Snip20210812_73.png)

### 3.3 断开连接的过程（4 次挥手）

- 第一次挥手
  - 客户端要求断开连接，发送一个断开的请求，这个叫作（FIN）

- 第二次挥手
  - 服务端收到请求，然后给客户端一个 ACK，作为 FIN 的响应。

```
这里你需要思考一个问题，可不可以像握手那样马上传 FIN 回去？
- 其实这个时候服务端不能马上传 FIN，因为断开连接要处理的问题比较多，比如说服务端可能还有发送出去的消息没有得到 ACK；也有可能服务端自己有资源要释放。
- 因此断开连接不能像握手那样操作——将两条消息合并。
```

- 第三次挥手
  - 服务端经过一个等待，确定可以关闭连接了，再发一条 FIN 给客户端。

- 第四次挥手
  - 客户端收到服务端的 FIN，同时客户端也可能有自己的事情需要处理完，比如客户端有发送给服务端没有收到 ACK 的请求，客户端自己处理完成后，再给服务端发送一个 ACK。

![image-20210812103217895](image/image-20210812103217895.png)



### 总结

```
TCP 提供连接（Connection），让双方的传输更加稳定、安全。

TCP 没有直接提供会话，因为应用对会话的需求多种多样，比如聊天程序会话在保持双方的聊天记录，电商程序会话在保持购物车、订单一致，所以会话通常在 TCP 连接上进一步封装，在应用层提供。

TCP 是一个面向连接的协议（Connection -oriented Protocol），说的就是 TCP 协议参与的双方（Host）在收发数据之前会先建立连接。后面我们还会学习 UDP 协议，UDP 是一个面向报文（Datagram-oriented）的协议——协议双方不需要建立连接，直接传送报文（数据）。

最后，连接需要消耗更多的资源。比如说，在传输数据前，必须先协商建立连接。因此，不是每种场景都应该用连接导向的协议。像视频播放的场景，如果使用连接导向的协议，服务端每向客户端推送一帧视频，客户端都要给服务端一次响应，这是不合理的。
```



### 面试题：TCP 为什么是 3 次握手，4 次挥手

```
【解析】TCP 是一个双工协议，为了让双方都保证，建立连接的时候，连接双方都需要向对方发送 SYC（同步请求）和 ACK（响应）。

握手阶段双方都没有烦琐的工作，因此一方向另一方发起同步（SYN）之后，另一方可以将自己的 ACK 和 SYN 打包作为一条消息回复，因此是 3 次握手——需要 3 次数据传输。

到了挥手阶段，双方都可能有未完成的工作。收到挥手请求的一方，必须马上响应（ACK），表示接收到了挥手请求。类比现实世界中，你收到一个 Offer，出于礼貌你先回复考虑一下，然后思考一段时间再回复 HR 最后的结果。最后等所有工作结束，再发送请求中断连接（FIN），因此是 4 次挥手
```



# 第二章 TCP 封包格式

# TCP 原理

# TCP 算法

# UDP 协议

