> 当前位置：【Java】05_JavaWeb_Database  -> 5.3_Oracle数据库

----



# 第一章 Oracle 下载安装和配置



## 0、Oracle 的下载

### Oracle Release 11.2.0.1.0 下载地址

#### **For Microsoft Windows (64-bit)**

http://download.oracle.com/otn/nt/oracle11g/112010/win64_11gR2_database_1of2.zip

http://download.oracle.com/otn/nt/oracle11g/112010/win64_11gR2_database_2of2.zip

http://download.oracle.com/otn/nt/oracle11g/112010/win64_11gR2_client.zip

http://download.oracle.com/otn/nt/oracle11g/112010/win64_11gR2_grid.zip

 

#### **For Microsoft Windows (32-bit)**

http://download.oracle.com/otn/nt/oracle11g/112010/win32_11gR2_database_1of2.zip

http://download.oracle.com/otn/nt/oracle11g/112010/win32_11gR2_database_2of2.zip

http://download.oracle.com/otn/nt/oracle11g/112010/win32_11gR2_client.zip

 

#### **For Linux x86**

http://download.oracle.com/otn/linux/oracle11g/R2/linux_11gR2_database_1of2.zip

http://download.oracle.com/otn/linux/oracle11g/R2/linux_11gR2_database_2of2.zip

http://download.oracle.com/otn/linux/oracle11g/R2/linux_11gR2_client.zip

http://download.oracle.com/otn/linux/oracle11g/R2/linux_11gR2_grid.zip

 

#### **For Linux x86-64**

http://download.oracle.com/otn/linux/oracle11g/R2/linux.x64_11gR2_database_1of2.zip

http://download.oracle.com/otn/linux/oracle11g/R2/linux.x64_11gR2_database_2of2.zip

http://download.oracle.com/otn/linux/oracle11g/R2/linux.x64_11gR2_client.zip

http://download.oracle.com/otn/linux/oracle11g/R2/linux.x64_11gR2_grid.zip



### Oracle Release 11.2.0.2.0 下载地址

- https://www.oracle.com/database/technologies/xe-prior-releases.html



### 图形化界面工具

- 软件1：PLSQL（Win）

- 软件2：Navicat（Win/Mac）



## 1、Docker - Oracle 安装和配置



## 2、Linux系统 - Oracle 安装和配置

### 2.1 Oracle 基本信息

```bash
- Oracle 安装目录home： /data/oracle/product/11.2.0
- Oracle 安装文件目录：/usr/local/Oracle11g/
- 账户：oracle
- 密码：oracle123456
```



### 2.2  Oracle 安装

#### 步骤1：将安装包上传到 /usr/local/upload/ 下

```shell
cd /usr/local/upload/
```



#### 步骤2：解压

```shell
# 下载解压软件
yum list | grep zip/unzip
yum install zip
yum install unzip 

# 解压
unzip linux.x64_11gR2_database_1of2.zip
unzip linux.x64_11gR2_database_2of2.zip

# 将解压后的文件夹直接移动到 /usr/local/Oracle11g/ 目录下
mkdir /usr/local/Oracle11g
mv /usr/local/download/database /usr/local/Oracle11g/

# 切换目录
cd /usr/local/Oracle11g/
```



#### 步骤3：关闭selinux

```shell
# 把 SELINUX=enforcing 改为 SELINUX=disabled
vim /etc/selinux/config

# 查看是否禁用（此处没有反应？）
setenforce 0
```



#### 步骤4：关闭防火墙

```shell
# CentOS6
service iptables stop
service iptables status
chkconfig iptables off

# CentOS7
systemctl restart firewalld.service
systemctl list-unit-files|grep firewalld.service
systemctl disable firewalld.service
```



#### 步骤5：安装Oracle 11g依赖包

```shell
yum install gcc make binutils gcc-c++ compat-libstdc++-33elfutils-libelf-devel elfutils-libelf-devel-static ksh libaio libaio-develnumactl-devel sysstat unixODBC unixODBC-devel pcre-devel –y
```



#### 步骤6：添加安装用户和用户组

```shell
# 密码设置 oracle123456
groupadd oinstall
groupadd dba
useradd -g oinstall -G dba oracle
passwd oracle

# 查看 oracle id
# 结果为 uid=1000(oracle) gid=1002(oinstall) 组=1002(oinstall),1003(dba)
id oracle
```



#### 步骤7：修改内核参数配置文件

```shell
vim /etc/sysctl.conf

# 末尾添加如下内容
# oracle11 修改内核参数配置文件  by 2021.01.19
fs.aio-max-nr = 1048576
fs.file-max = 6815744
kernel.shmall = 2097152
kernel.shmmax = 1073741824
kernel.shmmni = 4096
kernel.sem = 250 32000 100 128
net.ipv4.ip_local_port_range = 9000 65500
net.core.rmem_default = 262144
net.core.rmem_max = 4194304
net.core.wmem_default = 262144
net.core.wmem_max = 1048576

# 查看是否成功写进 /etc/sysctl.conf 文件
sysctl -p
```



#### 步骤8：修改用户的限制文件

```shell
vim /etc/security/limits.conf

# 末尾添加以下内容
# oracle11 修改用户的限制文件  by 2021.01.19
oracle           soft    nproc           2047
oracle           hard    nproc           16384
oracle           soft    nofile          1024
oracle           hard    nofile         65536
oracle           soft    stack           10240 
```



```shell
vim /etc/pam.d/login

# 末尾添加以下内容
# oracle11 修改用户的限制文件  by 2021.01.19
session required  /lib64/security/pam_limits.so
session required   pam_limits.so
```



```shell
vim /etc/profile

# 末尾添加以下内容
# oracle11 修改用户的限制文件  by 2021.01.19
if [ $USER = "oracle" ]; then
  if [ $SHELL = "/bin/ksh" ]; then
      ulimit -p 16384
      ulimit -n 65536
  else
      ulimit -u 16384 -n 65536
  fi
fi
```



#### 步骤9：创建安装目录和设置文件权限

```shell
cd /usr/local/Oracle11g/database/
mkdir -p /data/oracle/product/11.2.0
mkdir /data/oracle/oradata
mkdir /data/oracle/inventory
mkdir /data/oracle/fast_recovery_area
chown -R oracle:oinstall /data/oracle
chmod -R 775 /data/oracle
```



#### 步骤10：设置oracle用户环境变量

```shell
# 切换到oracle用户下
su -l oracle

vim .bash_profile

# 末尾添加以下内容（ORACLE_SID 必须与创建的数据库实例名称一致，否则数据库启动后无法访问）
# oracle11 修改用户的限制文件  by 2021.01.19
ORACLE_BASE=/data/oracle
ORACLE_HOME=$ORACLE_BASE/product/11.2.0
ORACLE_SID=orcl
PATH=$PATH:$ORACLE_HOME/bin
export ORACLE_BASE ORACLE_HOME ORACLE_SID PATH

# 刷新配置
source .bash_profile
```



#### 步骤11：编辑静默安装响应文件

```shell
# 复制安装文件夹 response 到当前oracle用户的家目录下
cp -R /usr/local/Oracle11g/database/response/ .
cd response/
vim db_install.rsp

# 末尾添加以下内容（ORACLE_SID 必须与创建的数据库实例名称一致，否则数据库启动后无法访问）
# oracle11 编辑静默安装响应文件  by 2021.01.19
oracle.install.option=INSTALL_DB_SWONLY
ORACLE_HOSTNAME=CentOS
UNIX_GROUP_NAME=oinstall
INVENTORY_LOCATION=/data/oracle/inventory
SELECTED_LANGUAGES=en,zh_CN
ORACLE_HOME=/data/oracle/product/11.2.0
ORACLE_BASE=/data/oracle
oracle.install.db.InstallEdition=EE
oracle.install.db.DBA_GROUP=dba
oracle.install.db.OPER_GROUP=dba
DECLINE_SECURITY_UPDATES=true
```



#### 步骤12：根据响应文件静默安装Oracle11g

```shell
# 当出现 Successfully Setup Software 表示安装成功
cd /usr/local/Oracle11g/database/
./runInstaller -silent -responseFile /home/oracle/response/db_install.rsp -ignorePrereq
```



#### 步骤13：执行脚本

```shell
# 退出到root身份登录
exit

# 执行脚本
sh /data/oracle/inventory/orainstRoot.sh
sh /data/oracle/product/11.2.0/root.sh
```



#### 步骤14：以静默方式配置监听

```shell
# 重新使用oracle用户登录
su -l oracle

# 成功运行后，在/data/oracle/product/11.2.0/network/admin中生成listener.ora和sqlnet.ora
netca /silent /responseFile /home/oracle/response/netca.rsp

# 使用root用户安装 netstat 软件
exit
yum install net-tools

# 通过 netstat 命令可以查看 1521 端口正在监听
netstat -tnulp | grep 1521

# 重新使用oracle用户登录
su -l oracle
```



#### 步骤15：以静默方式建立新库，同时也建立一个对应的实例

```shell
vim /home/oracle/response/dbca.rsp
```

修改内容

```shell
##############################################################################
##                                                                          ##
##                            DBCA response file                            ##
##                            ------------------                            ##
## Copyright   1998, 2007, Oracle Corporation. All Rights Reserved.         ##
##                                                                          ##
## Specify values for the variables listed below to customize Oracle        ##
## Database Configuration installation.                                     ##
##                                                                          ##
## Each variable is associated with a comment. The comment identifies the   ##
## variable type.                                                           ##
##                                                                          ##
## Please specify the values in the following format :                      ##
##          Type       :  Example                                           ##
##          String     :  "<value>"                                         ##
##          Boolean    :  True or False                                     ##
##          Number     :  <numeric value>                                   ##
##          StringList :  {"<value1>","<value2>"}                           ##
##                                                                          ##
## Examples :                                                               ##
##     1. dbca -progress_only -responseFile <response file>                 ##
##        Display a progress bar depicting progress of database creation    ##
##        process.                                                          ##
##                                                                          ##
##     2. dbca -silent -responseFile <response file>                        ##
##        Creates database silently. No user interface is displayed.        ##
##                                                                          ##
##     3. dbca -silent -createDatabase -cloneTemplate                       ##
##			 -responseFile <response file>                      ##
##        Creates database silently with clone template. The template in    ##
##	  responsefile is a clone template. 			            ##
##                                                                          ##
##     4. dbca -silent -deleteDatabase -responseFile <response file>        ##
##        Deletes database silently.                                        ##
##############################################################################

#-----------------------------------------------------------------------------
# GENERAL section is required for all types of database creations.
#-----------------------------------------------------------------------------
[GENERAL]

#-----------------------------------------------------------------------------
# Name          : RESPONSEFILE_VERSION
# Datatype      : String
# Description   : Version of the database to create
# Valid values  : "11.1.0"
# Default value : None
# Mandatory     : Yes
#-----------------------------------------------------------------------------
# oracle版本，不能更改
RESPONSEFILE_VERSION = "11.2.0"

#-----------------------------------------------------------------------------
# Name          : OPERATION_TYPE
# Datatype      : String
# Description   : Type of operation
# Valid values  : "createDatabase" \ "createTemplateFromDB" \ "createCloneTemplate" \ "deleteDatabase" \ "configureDatabase" \ "addInstance" (RAC-only) \ "deleteInstance" (RAC-only)
# Default value : None
# Mandatory     : Yes
#-----------------------------------------------------------------------------
OPERATION_TYPE = "createDatabase"

#-----------------------*** End of GENERAL section ***------------------------

#-----------------------------------------------------------------------------
# CREATEDATABASE section is used when OPERATION_TYPE is defined as "createDatabase". 
#-----------------------------------------------------------------------------
[CREATEDATABASE]

#-----------------------------------------------------------------------------
# Name          : GDBNAME
# Datatype      : String
# Description   : Global database name of the database
# Valid values  : <db_name>.<db_domain> - when database domain isn't NULL
#                 <db_name>             - when database domain is NULL
# Default value : None
# Mandatory     : Yes
#-----------------------------------------------------------------------------
# 全局数据库的名字=SID+主机域名
# 第三方工具链接数据库的时候使用的service名称
GDBNAME = "orcl.loto"

#-----------------------------------------------------------------------------
# Name          : POLICYMANAGED
# Datatype      : Boolean
# Description   : Set to true if Database is policy managed and 
#		  set to false if  Database is admin managed
# Valid values  : TRUE\FALSE
# Default value : FALSE
# Mandatory     : No
#-----------------------------------------------------------------------------
#POLICYMANAGED = "false"

#-----------------------------------------------------------------------------
# Name          : CREATESERVERPOOL
# Datatype      : Boolean
# Description   : Set to true if new server pool need to be created for database 
#		  if this option is specified then the newly created database 
#		  will use this newly created serverpool. 
#		  Multiple serverpoolname can not be specified for database
# Valid values  : TRUE\FALSE
# Default value : FALSE
# Mandatory     : No
#-----------------------------------------------------------------------------
#CREATESERVERPOOL = "false"

#-----------------------------------------------------------------------------
# Name          : FORCE
# Datatype      : Boolean
# Description   : Set to true if new server pool need to be created by force 
#		  if this option is specified then the newly created serverpool
#		  will be assigned server even if no free servers are available.
#		  This may affect already running database.
#		  This flag can be specified for Admin managed as well as policy managed db.
# Valid values  : TRUE\FALSE
# Default value : FALSE
# Mandatory     : No
#-----------------------------------------------------------------------------
#FORCE = "false"

#-----------------------------------------------------------------------------
# Name          : SERVERPOOLNAME
# Datatype      : String
# Description   : Only one serverpool name need to be specified 
#		   if Create Server Pool option is specified. 
#		   Comma-separated list of Serverpool names if db need to use
#		   multiple Server pool
# Valid values  : ServerPool name
# Default value : None
# Mandatory     : No [required in case of RAC service centric database]
#-----------------------------------------------------------------------------
#SERVERPOOLNAME = 

#-----------------------------------------------------------------------------
# Name          : CARDINALITY
# Datatype      : Number
# Description   : Specify Cardinality for create server pool operation
# Valid values  : any positive Integer value
# Default value : Number of qualified nodes on cluster
# Mandatory     : No [Required when a new serverpool need to be created]
#-----------------------------------------------------------------------------
#CARDINALITY = 

#-----------------------------------------------------------------------------
# Name          : SID
# Datatype      : String
# Description   : System identifier (SID) of the database
# Valid values  : Check Oracle11g Administrator's Guide
# Default value : <db_name> specified in GDBNAME
# Mandatory     : No
#-----------------------------------------------------------------------------
# 对应的实例名字
SID = "orcl"

#-----------------------------------------------------------------------------
# Name          : NODELIST
# Datatype      : String
# Description   : Comma-separated list of cluster nodes
# Valid values  : Cluster node names
# Default value : None
# Mandatory     : No (Yes for RAC database-centric database )
#-----------------------------------------------------------------------------
#NODELIST=

#-----------------------------------------------------------------------------
# Name          : TEMPLATENAME
# Datatype      : String
# Description   : Name of the template
# Valid values  : Template file name
# Default value : None
# Mandatory     : Yes
#-----------------------------------------------------------------------------
# 建库用的模板文件
TEMPLATENAME = "General_Purpose.dbc"

#-----------------------------------------------------------------------------
# Name          : OBFUSCATEDPASSWORDS
# Datatype      : Boolean
# Description   : Set to true if passwords are encrypted
# Valid values  : TRUE\FALSE
# Default value : FALSE
# Mandatory     : No
#-----------------------------------------------------------------------------
#OBFUSCATEDPASSWORDS = FALSE


#-----------------------------------------------------------------------------
# Name          : SYSPASSWORD
# Datatype      : String
# Description   : Password for SYS user
# Valid values  : Check Oracle11g Administrator's Guide
# Default value : None
# Mandatory     : Yes
#-----------------------------------------------------------------------------
# Sys 管理员密码
SYSPASSWORD = "oracle"

#-----------------------------------------------------------------------------
# Name          : SYSTEMPASSWORD
# Datatype      : String
# Description   : Password for SYSTEM user
# Valid values  : Check Oracle11g Administrator's Guide
# Default value : None
# Mandatory     : Yes
#-----------------------------------------------------------------------------
# System 管理员密码
SYSTEMPASSWORD = "oracle"

#-----------------------------------------------------------------------------
# Name          : EMCONFIGURATION
# Datatype      : String
# Description   : Enterprise Manager Configuration Type
# Valid values  : CENTRAL|LOCAL|ALL|NOBACKUP|NOEMAIL|NONE
# Default value : NONE
# Mandatory     : No
#-----------------------------------------------------------------------------
#EMCONFIGURATION = "NONE"

#-----------------------------------------------------------------------------
# Name          : DISABLESECURITYCONFIGURATION
# Datatype      : String
# Description   : Database Security Settings
# Valid values  : ALL|NONE|AUDIT|PASSWORD_PROFILE
# Default value : NONE
# Mandatory     : No
#-----------------------------------------------------------------------------
#DISABLESECURITYCONFIGURATION = "NONE"


#-----------------------------------------------------------------------------
# Name          : SYSMANPASSWORD
# Datatype      : String
# Description   : Password for SYSMAN user
# Valid values  : Check Oracle11g Administrator's Guide
# Default value : None
# Mandatory     : Yes, if LOCAL specified for EMCONFIGURATION
#-----------------------------------------------------------------------------
# Sysman 管理员密码
SYSMANPASSWORD = "oracle"

#-----------------------------------------------------------------------------
# Name          : DBSNMPPASSWORD
# Datatype      : String
# Description   : Password for DBSNMP user
# Valid values  : Check Oracle11g Administrator's Guide
# Default value : None
# Mandatory     : Yes, if EMCONFIGURATION is specified
#-----------------------------------------------------------------------------
# DBSNMP 管理员密码
DBSNMPPASSWORD = "oracle"

#-----------------------------------------------------------------------------
# Name          : CENTRALAGENT
# Datatype      : String
# Description   : Grid Control Central Agent Oracle Home
# Default value : None
# Mandatory     : Yes, if CENTRAL is specified for EMCONFIGURATION
#-----------------------------------------------------------------------------
#CENTRALAGENT = 

#-----------------------------------------------------------------------------
# Name          : HOSTUSERNAME
# Datatype      : String
# Description   : Host user name for EM backup job
# Default value : None
# Mandatory     : Yes, if ALL or NOEMAIL are specified for EMCONFIGURATION
#-----------------------------------------------------------------------------
#HOSTUSERNAME = 

#-----------------------------------------------------------------------------
# Name          : HOSTUSERPASSWORD
# Datatype      : String
# Description   : Host user password for EM backup job
# Default value : None
# Mandatory     : Yes, if ALL or NOEMAIL are specified for EMCONFIGURATION
#-----------------------------------------------------------------------------
#HOSTUSERPASSWORD= 

#-----------------------------------------------------------------------------
# Name          : BACKUPSCHEDULE
# Datatype      : String
# Description   : Daily backup schedule in the form of hh:mm
# Default value : 2:00
# Mandatory     : Yes, if ALL or NOEMAIL are specified for EMCONFIGURATION
#-----------------------------------------------------------------------------
#BACKUPSCHEDULE=

#-----------------------------------------------------------------------------
# Name          : SMTPSERVER
# Datatype      : String
# Description   : Outgoing mail (SMTP) server for email notifications
# Default value : None
# Mandatory     : Yes, if ALL or NOBACKUP are specified for EMCONFIGURATION
#-----------------------------------------------------------------------------
#SMTPSERVER =

#-----------------------------------------------------------------------------
# Name          : EMAILADDRESS
# Datatype      : String
# Description   : Email address for email notifications
# Default value : None
# Mandatory     : Yes, if ALL or NOBACKUP are specified for EMCONFIGURATION
#-----------------------------------------------------------------------------
#EMAILADDRESS =

#-----------------------------------------------------------------------------
# Name          : DVOWNERNAME
# Datatype      : String
# Description   : DataVault Owner
# Valid values  : Check Oracle11g Administrator's Guide
# Default value : None
# Mandatory     : Yes, if DataVault option is chosen
#-----------------------------------------------------------------------------
#DVOWNERNAME = ""

#-----------------------------------------------------------------------------
# Name          : DVOWNERPASSWORD
# Datatype      : String
# Description   : Password for DataVault Owner
# Valid values  : Check Oracle11g Administrator's Guide
# Default value : None
# Mandatory     : Yes, if DataVault option is chosen
#-----------------------------------------------------------------------------
#DVOWNERPASSWORD = ""

#-----------------------------------------------------------------------------
# Name          : DVACCOUNTMANAGERNAME
# Datatype      : String
# Description   : DataVault Account Manager
# Valid values  : Check Oracle11g Administrator's Guide
# Default value : None
# Mandatory     : No
#-----------------------------------------------------------------------------
#DVACCOUNTMANAGERNAME = ""

#-----------------------------------------------------------------------------
# Name          : DVACCOUNTMANAGERPASSWORD
# Datatype      : String
# Description   : Password for  DataVault Account Manager
# Valid values  : Check Oracle11g Administrator's Guide
# Default value : None
# Mandatory     : No
#-----------------------------------------------------------------------------
#DVACCOUNTMANAGERPASSWORD = ""



#-----------------------------------------------------------------------------
# Name          : DATAFILEJARLOCATION 
# Datatype      : String
# Description   : Location of the data file jar 
# Valid values  : Directory containing compressed datafile jar
# Default value : None
# Mandatory     : No
#-----------------------------------------------------------------------------
#DATAFILEJARLOCATION =

#-----------------------------------------------------------------------------
# Name          : DATAFILEDESTINATION 
# Datatype      : String
# Description   : Location of the data file's
# Valid values  : Directory for all the database files
# Default value : $ORACLE_BASE/oradata
# Mandatory     : No
#-----------------------------------------------------------------------------
# 数据文件存放目录
DATAFILEDESTINATION =/data/oracle/oradata

#-----------------------------------------------------------------------------
# Name          : RECOVERYAREADESTINATION
# Datatype      : String
# Description   : Location of the data file's
# Valid values  : Recovery Area location
# Default value : $ORACLE_BASE/flash_recovery_area
# Mandatory     : No
#-----------------------------------------------------------------------------
# 恢复数据存放目录
RECOVERYAREADESTINATION=/data/oracle/fast_recovery_area

#-----------------------------------------------------------------------------
# Name          : STORAGETYPE
# Datatype      : String
# Description   : Specifies the storage on which the database is to be created
# Valid values  : FS (CFS for RAC), ASM
# Default value : FS
# Mandatory     : No
#-----------------------------------------------------------------------------
#STORAGETYPE=FS

#-----------------------------------------------------------------------------
# Name          : DISKGROUPNAME
# Datatype      : String
# Description   : Specifies the disk group name for the storage
# Default value : DATA
# Mandatory     : No
#-----------------------------------------------------------------------------
#DISKGROUPNAME=DATA

#-----------------------------------------------------------------------------
# Name          : ASMSNMP_PASSWORD
# Datatype      : String
# Description   : Password for ASM Monitoring
# Default value : None
# Mandatory     : No
#-----------------------------------------------------------------------------
#ASMSNMP_PASSWORD=""

#-----------------------------------------------------------------------------
# Name          : RECOVERYGROUPNAME
# Datatype      : String
# Description   : Specifies the disk group name for the recovery area
# Default value : RECOVERY
# Mandatory     : No
#-----------------------------------------------------------------------------
#RECOVERYGROUPNAME=RECOVERY


#-----------------------------------------------------------------------------
# Name          : CHARACTERSET
# Datatype      : String
# Description   : Character set of the database
# Valid values  : Check Oracle11g National Language Support Guide
# Default value : "US7ASCII"
# Mandatory     : NO
#-----------------------------------------------------------------------------
# 字符集
CHARACTERSET = "ZHS16GBK"

#-----------------------------------------------------------------------------
# Name          : NATIONALCHARACTERSET
# Datatype      : String
# Description   : National Character set of the database
# Valid values  : "UTF8" or "AL16UTF16". For details, check Oracle11g National Language Support Guide
# Default value : "AL16UTF16"
# Mandatory     : No
#-----------------------------------------------------------------------------
#NATIONALCHARACTERSET= "UTF8"

#-----------------------------------------------------------------------------
# Name          : REGISTERWITHDIRSERVICE
# Datatype      : Boolean
# Description   : Specifies whether to register with Directory Service.
# Valid values  : TRUE \ FALSE
# Default value : FALSE
# Mandatory     : No
#-----------------------------------------------------------------------------
#REGISTERWITHDIRSERVICE= TRUE

#-----------------------------------------------------------------------------
# Name          : DIRSERVICEUSERNAME
# Datatype      : String
# Description   : Specifies the name of the directory service user
# Mandatory     : YES, if the value of registerWithDirService is TRUE
#-----------------------------------------------------------------------------
#DIRSERVICEUSERNAME= "name"

#-----------------------------------------------------------------------------
# Name          : DIRSERVICEPASSWORD
# Datatype      : String
# Description   : The password of the directory service user.
#		  You can also specify the password at the command prompt instead of here.
# Mandatory     : YES, if the value of registerWithDirService is TRUE
#-----------------------------------------------------------------------------
#DIRSERVICEPASSWORD= "password"

#-----------------------------------------------------------------------------
# Name          : WALLETPASSWORD
# Datatype      : String
# Description   : The password for wallet to created or modified.
#		  You can also specify the password at the command prompt instead of here.
# Mandatory     : YES, if the value of registerWithDirService is TRUE
#-----------------------------------------------------------------------------
#WALLETPASSWORD= "password"

#-----------------------------------------------------------------------------
# Name          : LISTENERS
# Datatype      : String
# Description   : Specifies list of listeners to register the database with.
#		  By default the database is configured for all the listeners specified in the 
#		  $ORACLE_HOME/network/admin/listener.ora 	
# Valid values  : The list should be space separated names like "listener1 listener2".
# Mandatory     : NO
#-----------------------------------------------------------------------------
#LISTENERS = "listener1 listener2"

#-----------------------------------------------------------------------------
# Name          : VARIABLESFILE 
# Datatype      : String
# Description   : Location of the file containing variable value pair
# Valid values  : A valid file-system file. The variable value pair format in this file 
#		  is <variable>=<value>. Each pair should be in a new line.
# Default value : None
# Mandatory     : NO
#-----------------------------------------------------------------------------
#VARIABLESFILE =

#-----------------------------------------------------------------------------
# Name          : VARIABLES
# Datatype      : String
# Description   : comma separated list of name=value pairs. Overrides variables defined in variablefile and templates
# Default value : None
# Mandatory     : NO
#-----------------------------------------------------------------------------
#VARIABLES =

#-----------------------------------------------------------------------------
# Name          : INITPARAMS
# Datatype      : String
# Description   : comma separated list of name=value pairs. Overrides initialization parameters defined in templates
# Default value : None
# Mandatory     : NO
#-----------------------------------------------------------------------------
#INITPARAMS =

#-----------------------------------------------------------------------------
# Name          : MEMORYPERCENTAGE
# Datatype      : String
# Description   : percentage of physical memory for Oracle
# Default value : None
# Mandatory     : NO
#-----------------------------------------------------------------------------
#MEMORYPERCENTAGE = "40"

#-----------------------------------------------------------------------------
# Name          : DATABASETYPE
# Datatype      : String
# Description   : used for memory distribution when MEMORYPERCENTAGE specified
# Valid values  : MULTIPURPOSE|DATA_WAREHOUSING|OLTP
# Default value : MULTIPURPOSE
# Mandatory     : NO
#-----------------------------------------------------------------------------
#DATABASETYPE = "MULTIPURPOSE"

#-----------------------------------------------------------------------------
# Name          : AUTOMATICMEMORYMANAGEMENT
# Datatype      : Boolean
# Description   : flag to indicate Automatic Memory Management is used
# Valid values  : TRUE/FALSE
# Default value : TRUE
# Mandatory     : NO
#-----------------------------------------------------------------------------
#AUTOMATICMEMORYMANAGEMENT = "TRUE"

#-----------------------------------------------------------------------------
# Name          : TOTALMEMORY
# Datatype      : String
# Description   : total memory in MB to allocate to Oracle
# Valid values  : 
# Default value : 
# Mandatory     : NO
#-----------------------------------------------------------------------------
# oracle内存1638MB，物理内存2G*80%
TOTALMEMORY = "1638" 


#-----------------------*** End of CREATEDATABASE section ***------------------------

#-----------------------------------------------------------------------------
# createTemplateFromDB section is used when OPERATION_TYPE is defined as "createTemplateFromDB". 
#-----------------------------------------------------------------------------
[createTemplateFromDB]
#-----------------------------------------------------------------------------
# Name          : SOURCEDB 
# Datatype      : String
# Description   : The source database from which to create the template
# Valid values  : The format is <host>:<port>:<sid>
# Default value : none
# Mandatory     : YES
#-----------------------------------------------------------------------------
SOURCEDB = "myhost:1521:orcl"

#-----------------------------------------------------------------------------
# Name          : SYSDBAUSERNAME 
# Datatype      : String
# Description   : A user with DBA role.
# Default value : none
# Mandatory     : YES
#-----------------------------------------------------------------------------
SYSDBAUSERNAME = "system"

#-----------------------------------------------------------------------------
# Name          : SYSDBAPASSWORD 
# Datatype      : String
# Description   : The password of the DBA user.
#		  You can also specify the password at the command prompt instead of here.
# Default value : none
# Mandatory     : YES
#-----------------------------------------------------------------------------
#SYSDBAPASSWORD = "password"

#-----------------------------------------------------------------------------
# Name          : TEMPLATENAME
# Datatype      : String
# Description   : Name for the new template.
# Default value : None
# Mandatory     : Yes
#-----------------------------------------------------------------------------
TEMPLATENAME = "My Copy TEMPLATE"

#-----------------------*** End of createTemplateFromDB section ***------------------------

#-----------------------------------------------------------------------------
# createCloneTemplate section is used when OPERATION_TYPE is defined as "createCloneTemplate". 
#-----------------------------------------------------------------------------
[createCloneTemplate]
#-----------------------------------------------------------------------------
# Name          : SOURCEDB
# Datatype      : String
# Description   : The source database is the SID from which to create the template. 
#		  This database must be local and on the same ORACLE_HOME.
# Default value : none
# Mandatory     : YES
#-----------------------------------------------------------------------------
SOURCEDB = "orcl"

#-----------------------------------------------------------------------------
# Name          : SYSDBAUSERNAME
# Datatype      : String
# Description   : A user with DBA role.
# Default value : none
# Mandatory     : YES, if no OS authentication
#-----------------------------------------------------------------------------
#SYSDBAUSERNAME = "sys"

#-----------------------------------------------------------------------------
# Name          : SYSDBAPASSWORD
# Datatype      : String
# Description   : The password of the DBA user.
#		  You can also specify the password at the command prompt instead of here.
# Default value : none
# Mandatory     : YES
#-----------------------------------------------------------------------------
#SYSDBAPASSWORD = "password"

#-----------------------------------------------------------------------------
# Name          : TEMPLATENAME
# Datatype      : String
# Description   : Name for the new template.
# Default value : None
# Mandatory     : Yes
#-----------------------------------------------------------------------------
TEMPLATENAME = "My Clone TEMPLATE"

#-----------------------------------------------------------------------------
# Name          : DATAFILEJARLOCATION
# Datatype      : String
# Description   : Location of the data file jar 
# Valid values  : Directory where the new compressed datafile jar will be placed
# Default value : $ORACLE_HOME/assistants/dbca/templates
# Mandatory     : NO
#-----------------------------------------------------------------------------
#DATAFILEJARLOCATION = 

#-----------------------*** End of createCloneTemplate section ***------------------------

#-----------------------------------------------------------------------------
# DELETEDATABASE section is used when DELETE_TYPE is defined as "deleteDatabase". 
#-----------------------------------------------------------------------------
[DELETEDATABASE]
#-----------------------------------------------------------------------------
# Name          : SOURCEDB
# Datatype      : String
# Description   : The source database is the SID 
#		  This database must be local and on the same ORACLE_HOME.
# Default value : none
# Mandatory     : YES
#-----------------------------------------------------------------------------
SOURCEDB = "orcl"

#-----------------------------------------------------------------------------
# Name          : SYSDBAUSERNAME
# Datatype      : String
# Description   : A user with DBA role.
# Default value : none
# Mandatory     : YES, if no OS authentication
#-----------------------------------------------------------------------------
#SYSDBAUSERNAME = "sys"

#-----------------------------------------------------------------------------
# Name          : SYSDBAPASSWORD
# Datatype      : String
# Description   : The password of the DBA user.
#		  You can also specify the password at the command prompt instead of here.
# Default value : none
# Mandatory     : YES, if no OS authentication
#-----------------------------------------------------------------------------
#SYSDBAPASSWORD = "password"
#-----------------------*** End of deleteDatabase section ***------------------------

#-----------------------------------------------------------------------------
# GENERATESCRIPTS section 
#-----------------------------------------------------------------------------
[generateScripts]
#-----------------------------------------------------------------------------
# Name          : TEMPLATENAME
# Datatype      : String
# Description   : Name of the template
# Valid values  : Template name as seen in DBCA
# Default value : None
# Mandatory     : Yes
#-----------------------------------------------------------------------------
TEMPLATENAME = "New Database"

#-----------------------------------------------------------------------------
# Name          : GDBNAME
# Datatype      : String
# Description   : Global database name of the database
# Valid values  : <db_name>.<db_domain> - when database domain isn't NULL
#                 <db_name>             - when database domain is NULL
# Default value : None
# Mandatory     : Yes
#-----------------------------------------------------------------------------
GDBNAME = "orcl11.us.oracle.com"

#-----------------------------------------------------------------------------
# Name          : SCRIPTDESTINATION 
# Datatype      : String
# Description   : Location of the scripts
# Valid values  : Directory for all the scripts
# Default value : None
# Mandatory     : No
#-----------------------------------------------------------------------------
#SCRIPTDESTINATION =

#-----------------------*** End of deleteDatabase section ***------------------------

#-----------------------------------------------------------------------------
# CONFIGUREDATABASE section is used when OPERATION_TYPE is defined as "configureDatabase". 
#-----------------------------------------------------------------------------
[CONFIGUREDATABASE]

#-----------------------------------------------------------------------------
# Name          : SOURCEDB
# Datatype      : String
# Description   : The source database is the SID 
#		  This database must be local and on the same ORACLE_HOME.
# Default value : none
# Mandatory     : YES
#-----------------------------------------------------------------------------
#SOURCEDB = "orcl"

#-----------------------------------------------------------------------------
# Name          : SYSDBAUSERNAME
# Datatype      : String
# Description   : A user with DBA role.
# Default value : none
# Mandatory     : YES, if no OS authentication
#-----------------------------------------------------------------------------
#SYSDBAUSERNAME = "sys"


#-----------------------------------------------------------------------------
# Name          : SYSDBAPASSWORD
# Datatype      : String
# Description   : The password of the DBA user.
#		  You can also specify the password at the command prompt instead of here.
# Default value : none
# Mandatory     : YES, if no OS authentication
#-----------------------------------------------------------------------------
#SYSDBAPASSWORD =

#-----------------------------------------------------------------------------
# Name          : REGISTERWITHDIRSERVICE
# Datatype      : Boolean
# Description   : Specifies whether to register with Directory Service.
# Valid values  : TRUE \ FALSE
# Default value : FALSE
# Mandatory     : No
#-----------------------------------------------------------------------------
#REGISTERWITHDIRSERVICE= TRUE

#-----------------------------------------------------------------------------
# Name          : UNREGISTERWITHDIRSERVICE
# Datatype      : Boolean
# Description   : Specifies whether to unregister with Directory Service.
# Valid values  : TRUE \ FALSE
# Default value : FALSE
# Mandatory     : No
#-----------------------------------------------------------------------------
#UNREGISTERWITHDIRSERVICE= TRUE

#-----------------------------------------------------------------------------
# Name          : REGENERATEDBPASSWORD
# Datatype      : Boolean
# Description   : Specifies whether regenerate database password in OID/Wallet
# Valid values  : TRUE \ FALSE
# Default value : FALSE
# Mandatory     : No
#-----------------------------------------------------------------------------
#REGENERATEDBPASSWORD= TRUE

#-----------------------------------------------------------------------------
# Name          : DIRSERVICEUSERNAME
# Datatype      : String
# Description   : Specifies the name of the directory service user
# Mandatory     : YES, if the any of the reg/unreg/regenPasswd options specified
#-----------------------------------------------------------------------------
#DIRSERVICEUSERNAME= "name"

#-----------------------------------------------------------------------------
# Name          : DIRSERVICEPASSWORD
# Datatype      : String
# Description   : The password of the directory service user.
#		  You can also specify the password at the command prompt instead of here.
# Mandatory     : YES, if the any of the reg/unreg/regenPasswd options specified
#-----------------------------------------------------------------------------
#DIRSERVICEPASSWORD= "password"

#-----------------------------------------------------------------------------
# Name          : WALLETPASSWORD
# Datatype      : String
# Description   : The password for wallet to created or modified.
#		  You can also specify the password at the command prompt instead of here.
# Mandatory     : YES, if the any of the reg/unreg/regenPasswd options specified
#-----------------------------------------------------------------------------
#WALLETPASSWORD= "password"

#-----------------------------------------------------------------------------
# Name          : DISABLESECURITYCONFIGURATION
# Datatype      : String
# Description   : Database Security Settings
# Valid values  : ALL|NONE|AUDIT|PASSWORD_PROFILE
# Default value : NONE
# Mandatory     : No
#-----------------------------------------------------------------------------
#DISABLESECURITYCONFIGURATION = "NONE"



#-----------------------------------------------------------------------------
# Name          : ENABLESECURITYCONFIGURATION
# Datatype      : String
# Description   : Database Security Settings
# Valid values  : true|false
# Default value : true
# Mandatory     : No
#-----------------------------------------------------------------------------
#ENABLESECURITYCONFIGURATION = "true"


#-----------------------------------------------------------------------------
# Name          : EMCONFIGURATION
# Datatype      : String
# Description   : Enterprise Manager Configuration Type
# Valid values  : CENTRAL|LOCAL|ALL|NOBACKUP|NOEMAIL|NONE
# Default value : NONE
# Mandatory     : No
#-----------------------------------------------------------------------------
#EMCONFIGURATION = "NONE"

#-----------------------------------------------------------------------------
# Name          : SYSMANPASSWORD
# Datatype      : String
# Description   : Password for SYSMAN user
# Valid values  : Check Oracle11g Administrator's Guide
# Default value : None
# Mandatory     : Yes, if LOCAL specified for EMCONFIGURATION
#-----------------------------------------------------------------------------
#SYSMANPASSWORD = "password"

#-----------------------------------------------------------------------------
# Name          : DBSNMPPASSWORD
# Datatype      : String
# Description   : Password for DBSNMP user
# Valid values  : Check Oracle11g Administrator's Guide
# Default value : None
# Mandatory     : Yes, if EMCONFIGURATION is specified
#-----------------------------------------------------------------------------
#DBSNMPPASSWORD = "password"

#-----------------------------------------------------------------------------
# Name          : CENTRALAGENT
# Datatype      : String
# Description   : Grid Control Central Agent Oracle Home
# Default value : None
# Mandatory     : Yes, if CENTRAL is specified for EMCONFIGURATION
#-----------------------------------------------------------------------------
#CENTRALAGENT = 

#-----------------------------------------------------------------------------
# Name          : HOSTUSERNAME
# Datatype      : String
# Description   : Host user name for EM backup job
# Default value : None
# Mandatory     : Yes, if ALL or NOEMAIL are specified for EMCONFIGURATION
#-----------------------------------------------------------------------------
#HOSTUSERNAME = 

#-----------------------------------------------------------------------------
# Name          : HOSTUSERPASSWORD
# Datatype      : String
# Description   : Host user password for EM backup job
# Default value : None
# Mandatory     : Yes, if ALL or NOEMAIL are specified for EMCONFIGURATION
#-----------------------------------------------------------------------------
#HOSTUSERPASSWORD= 

#-----------------------------------------------------------------------------
# Name          : BACKUPSCHEDULE
# Datatype      : String
# Description   : Daily backup schedule in the form of hh:mm
# Default value : 2:00
# Mandatory     : Yes, if ALL or NOEMAIL are specified for EMCONFIGURATION
#-----------------------------------------------------------------------------
#BACKUPSCHEDULE=

#-----------------------------------------------------------------------------
# Name          : SMTPSERVER
# Datatype      : String
# Description   : Outgoing mail (SMTP) server for email notifications
# Default value : None
# Mandatory     : Yes, if ALL or NOBACKUP are specified for EMCONFIGURATION
#-----------------------------------------------------------------------------
#SMTPSERVER =

#-----------------------------------------------------------------------------
# Name          : EMAILADDRESS
# Datatype      : String
# Description   : Email address for email notifications
# Default value : None
# Mandatory     : Yes, if ALL or NOBACKUP are specified for EMCONFIGURATION
#-----------------------------------------------------------------------------
#EMAILADDRESS =

#-----------------------*** End of CONFIGUREDATABASE section ***------------------------


#-----------------------------------------------------------------------------
# ADDINSTANCE section is used when OPERATION_TYPE is defined as "addInstance". 
#-----------------------------------------------------------------------------
[ADDINSTANCE]

#-----------------------------------------------------------------------------
# Name          : DB_UNIQUE_NAME
# Datatype      : String
# Description   : DB Unique Name of the RAC database
# Valid values  : <db_unique_name>
# Default value : None
# Mandatory     : Yes
#-----------------------------------------------------------------------------
DB_UNIQUE_NAME = "orcl11g.us.oracle.com"

#-----------------------------------------------------------------------------
# Name          : INSTANCENAME
# Datatype      : String
# Description   : RAC instance name to be added
# Valid values  : Check Oracle11g Administrator's Guide
# Default value : <sid_prefix>+<highest_current_thread+1>
# Mandatory     : No
#-----------------------------------------------------------------------------
#INSTANCENAME = "orcl1"

#-----------------------------------------------------------------------------
# Name          : NODELIST
# Datatype      : String
# Description   : Node on which to add new instance 
#                 (in 10gR2, instance addition is supported on 1 node at a time)
# Valid values  : Cluster node name
# Default value : None
# Mandatory     : Yes
#-----------------------------------------------------------------------------
NODELIST=

#-----------------------------------------------------------------------------
# Name          : OBFUSCATEDPASSWORDS
# Datatype      : Boolean
# Description   : Set to true if passwords are encrypted
# Valid values  : TRUE\FALSE
# Default value : FALSE
# Mandatory     : No
#-----------------------------------------------------------------------------
#OBFUSCATEDPASSWORDS = FALSE

#-----------------------------------------------------------------------------
# Name          : SYSDBAUSERNAME 
# Datatype      : String
# Description   : A user with DBA role.
# Default value : none
# Mandatory     : YES
#-----------------------------------------------------------------------------
SYSDBAUSERNAME = "sys"

#-----------------------------------------------------------------------------
# Name          : SYSDBAPASSWORD 
# Datatype      : String
# Description   : The password of the DBA user.
# Default value : none
# Mandatory     : YES
#-----------------------------------------------------------------------------
#SYSDBAPASSWORD = "password"

#-----------------------*** End of ADDINSTANCE section ***------------------------


#-----------------------------------------------------------------------------
# DELETEINSTANCE section is used when OPERATION_TYPE is defined as "deleteInstance". 
#-----------------------------------------------------------------------------
[DELETEINSTANCE]

#-----------------------------------------------------------------------------
# Name          : DB_UNIQUE_NAME
# Datatype      : String
# Description   : DB Unique Name of the RAC database
# Valid values  : <db_unique_name>
# Default value : None
# Mandatory     : Yes
#-----------------------------------------------------------------------------
DB_UNIQUE_NAME = "orcl11g.us.oracle.com"

#-----------------------------------------------------------------------------
# Name          : INSTANCENAME
# Datatype      : String
# Description   : RAC instance name to be deleted
# Valid values  : Check Oracle11g Administrator's Guide
# Default value : None
# Mandatory     : Yes
#-----------------------------------------------------------------------------
INSTANCENAME = "orcl11g"

#-----------------------------------------------------------------------------
# Name          : NODELIST
# Datatype      : String
# Description   : Node on which instance to be deleted (SID) is located
# Valid values  : Cluster node name
# Default value : None
# Mandatory     : No
#-----------------------------------------------------------------------------
#NODELIST=

#-----------------------------------------------------------------------------
# Name          : OBFUSCATEDPASSWORDS
# Datatype      : Boolean
# Description   : Set to true if passwords are encrypted
# Valid values  : TRUE\FALSE
# Default value : FALSE
# Mandatory     : No
#-----------------------------------------------------------------------------
#OBFUSCATEDPASSWORDS = FALSE

#-----------------------------------------------------------------------------
# Name          : SYSDBAUSERNAME 
# Datatype      : String
# Description   : A user with DBA role.
# Default value : none
# Mandatory     : YES
#-----------------------------------------------------------------------------
SYSDBAUSERNAME = "sys"

#-----------------------------------------------------------------------------
# Name          : SYSDBAPASSWORD 
# Datatype      : String
# Description   : The password of the DBA user.
# Default value : none
# Mandatory     : YES
#-----------------------------------------------------------------------------
#SYSDBAPASSWORD = "password"


#-----------------------*** End of DELETEINSTANCE section ***------------------------
```



```shell
# 进行静默配置（100% 已完成 表示成功）
dbca -silent -responseFile /home/oracle/response/dbca.rsp

# 建库后进行实例进程检查
ps -ef | grep ora_ | grep -v grep

# 查看监听状态
lsnrctl status

# 修改ORACLE_SID和/home/oracle/response/dbca.rsp中的一样
export ORACLE_SID=orcl
```

步骤16：登录查看实例状态

```shell
# 使用 sysdba 登录 oracle 数据库（不需要密码）
sqlplus / as sysdba

# 使用 sql 查询实例状态（正常显示open）
select status from v$instance;
```



### 2.3 Oracle 配置（开机自启监听和实例）

- 步骤0：查看Oracle的安装目录

```shell
# 查看 inventory_loc 文件位置（/data/oracle/inventory）
cat /etc/oraInst.loc

# 找 /data/oracle/inventory 目录下的 /ContentsXML/inventory.xml
cat /data/oracle/inventory/ContentsXML/inventory.xml

# 可以看到安装目录为 LOC="/data/oracle/product/11.2.0"
```



- 步骤1：修改文件

```shell
# 找到 ORACLE_HOME_LISTNER=$1，修改为 ORACLE_HOME_LISTNER=$ORACLE_HOME
# 两个文件的目录为：/data/oracle/product/11.2.0/bin/下
vim $ORACLE_HOME/bin/dbstart
vim $ORACLE_HOME/bin/dbshut
```



- 步骤2：修改 /etc/oratab 文件

```shell
vim /etc/oratab

# 添加以下内容
# orcl为实例名
# /data/oracle/product/11.2.0/bin 为oracle安装目录
# Oracle 数据库开机自启监听和实例 by 2021.01.19
orcl:/data/oracle/product/11.2.0:Y
```



- 步骤3：把 lsnrctl start 和 dbstart 添加到 rc.local 文件中

```shell
vim /etc/rc.d/rc.local

# Oracle数据库开机自启监听和实例   by 2021.01.19
su oracle -lc "/data/oracle/product/11.2.0/bin/lsnrctl start"
su oracle -lc /data/oracle/product/11.2.0/bin/dbstart
```



### 2.4 Oracle 卸载

#### 步骤1：首先查看dbca的帮助信息

```shell
dbca -help
```



#### 步骤2：修改 dbca.rsp 文件

```shell
vim /home/oracle/response/dbca.rsp

#下面三个参数根据建库实际情况进行修改
OPERATION_TYPE = "deleteDatabase"
SOURCEDB = "orcl"
SYSDBAUSERNAME = "sys"
SYSDBAPASSWORD = "123456"
```



#### 步骤3：卸载数据库

```shell
dbca -silent -responseFile /home/oracle/response/dbca.rsp

# 各参数含义如下
-silent：表示以静默方式删除
-responseFile：表示使用哪个响应文件,必需使用绝对路径
  RESPONSEFILE_VERSION 响应文件模板的版本,该参数不要更改
  OPERATION_TYPE 安装类型,该参数不要更改
  SOURCEDB 数据库名,不是全局数据库名,即不包含db_domain
```



#### 步骤4：使用 DBCA 卸载数据库软件

```shell
dbca -silent -delete Database -responseFile dbca.rsp

# 各参数含义如下
-silent表示静默安装，免安装交互，大部分安装信息也不输出
-responseFile指定应答文件，要求用绝对路径
```



### 2.5 Oracle 创建数据库用户

- 步骤1：切换到oracle用户下

```shell
su -l oracle
```



- 步骤2：使用sysdba账户登录

```shell
sqlplus / as sysdba
```



- 步骤3：创建用户

```shell
# 语法：CREATE USER 用户名 IDENTIFIED BY 密码;
CREATE USER td IDENTIFIED BY td;
```



- 步骤4：授予新登陆的用户创建权限:

```shell
# 语法：CRANT CREATE SESSION TO 用户名
grant create session to td;
```



- 步骤5：授予新创建的用户数据库管理员权限

```shell
# 语法：CRANT DBA TO 用户名;
grant dba to td;
```



- 切换到新创建的用户登陆

```shell
# 语法：CONNECT 用户名/密码
connect td/td;
```



- 删除用户

```shell
# 语法：DROP USER 用户名
drop user mmzsit
```



- 将创建的用户解锁/锁住

```shell
# 语法：ALTER USER 用户名 ACCOUNT UNLOCK/LOCK

# 用户锁住
alter user td account lock; 

# 用户解锁
alter user td account unlock;
```



### 2.6 Oracle 启动和关闭

```bash
# 使用oracle用户登录
# 用户名：oracle
# 密码：oracle123456
su -l oracle

# 查看监听是否启动
lsnrctl status

# 查看数据库是否启动
ps -ef |grep ora_

# 通过 netstat 命令可以查看 1521 端口正在监听
netstat -tnulp | grep 1521

# =============以下为手动启动================#

# 启动监听
lsnrctl start

# 使用 sysdba 登录 oracle 数据库（不需要密码）
sqlplus / as sysdba

# 启动数据库
startup

# =============手动启动完成==================#

# 查看数据库是否处于open状态
select status from v$instance;

# 查看 ORACLE_HOME (/data/oracle/product/11.2.0)
echo $ORACLE_HOME
```



#### 几种启动方式

```xml
1、startup nomount
非安装启动，这种方式启动下可执行：重建控制文件、重建数据库启动instance，即启动SGA和后台进程，这种启动只需要init.ora文件。

2、startup mount dbname
安装启动，这种方式启动下可执行：数据库日志归档、数据库恢复、重新命名一些数据库文件如：系统表空间或日志文件。执行“nomount”，然后打开控制文件。

3、startup open dbname
先执行“nomount”，然后执行“mount”，再打开包括Redo log文件在内的所有数据库文件，这种方式下可访问数据库中的数据。

4、startup
等于以下三个命令startup nomountalter database mountalter database open

5、startup restrict
约束方式启动这种方式能够启动数据库，但只允许具有一定特权的用户访问非特权用户访问时，会出现以下提示：ERROR：ORA-01035: ORACLE 只允许具有 RESTRICTED SESSION 权限的用户使用。

6、startup force
强制启动方式当不能关闭数据库时，可以用startup force来完成数据库的关闭先关闭数据库，再执行正常启动数据库命令

7、startup pfile=参数文件名带初始化参数文件的启动方式
先读取参数文件，再按参数文件中的设置启动数据库例：startup pfile=E:/Oracle/admin/oradb/pfile/init.ora8、startup EXCLUSIVE
```



#### 几种关闭方式

```xml
1、shutdown normal
正常方式关闭数据库

2、shutdown immediate
立即方式关闭数据库。在SVRMGRL中执行shutdown immediate，数据库并不立即关闭，而是在Oracle执行某些清除工作后才关闭（终止会话、释放会话资源），当使用shutdown不能关闭数据库时，shutdown immediate可以完成数据库关闭的操作。

3、shutdown abort
直接关闭数据库，正在访问数据库的会话会被突然终止，如果数据库中有大量操作正在执行，这时执行shutdown abort后，重新启动数据库需要很长时间。
```



### 2.7 报错信息

#### 1、Oracle监听启动失败“TNS-12541：TNS： No Listener”

```shell
# 启动监听
lsnrctl start

# 报错
TNS-12541：TNS： No Listener
TNS-12560：TNS：Protocol adapter error
TNS-00511：TNS：No Listener
Linux error：lll：Connection refused

# 解决方案
# （1）关闭数据库
shutdown immediate

#（2）修改 /etc/hosts文件（注意必须要有127.0.0.1这行，本身系统默认就有，第二行是服务器的地址）
127.0.0.1               localhost.localdomain   localhost 
192.168.31.130          OracleServer

#（3）再次执行
lsnrctl start

启动顺序：要先启动Listener，再启动database，才可以成功！
```



## 3、Win系统 -  Oracle 安装和配置



## 4、Mac系统 -  Oracle 安装和配置





# 第二章 Oracle 语法

























#### 解决锁表问题

```
-- （1）查询
select b.username,b.sid,b.serial#,logon_time  
from v$locked_object a,v$session b  
where a.session_id = b.sid order by b.logon_time; 

-- （2）传参 id,serial#
alter system kill session'1015,4562';
```



#### NVL函数的格式如下：NVL(expr1,expr2)

含义是：如果oracle第一个参数为空那么显示第二个参数的值，如果第一个参数的值不为空，则显示第一个参数本来的值。

```sql
-- 如果查到的 isTimeTypeSpell 为空，则默认返回0，如果不为空，则返回实际值
NVL(isTimeTypeSpell,'0')        AS "isTimeTypeSpell",
```





#### varchar 

varchar -- 存放定長的字符数据，最长2000個字符；

varchar2 -- 存放可变长字符数据，最大长度为4000字符



#### 查询连接数

```sql
--  查看连接数
 select USERNAME,MACHINE,PROGRAM from v$session
select machine, count(*) c from v$session group by machine order by c desc;


-- 数据库允许的最大连接数
select value from v$parameter where name = 'processes' ;

-- 设置最大连接数
alter system set processes = 2000 scope = spfile;

select count(*) from v$session;  -- 总会话数
select count(*) from v$process;  -- 总连接数
show parameter processes;
select count(*) as processCount from v$process; 

-- 查看不同用户的会话数和连接数
select username,count(username) from v$session where username is not null group by username;
select username,count(username) from v$process where username is not null group by username;

-- 查看所有用户
select * from all_users;

-- 查看用户或角色所拥有的角色
select * from user_role_privs;

-- 查看oracle版本
select banner from sys.v_$version;

-- 查询那些应用的连接数此时是多少
select b.MACHINE, b.PROGRAM, count(*)
  from v$process a, v$session b
 where a.ADDR = b.PADDR
   and b.USERNAME is not null
 group by b.MACHINE, b.PROGRAM
 order by count(*) desc;

-- 查询是否有死锁
select * from v$locked_object;

-- 查询执行最慢的sql
select *
 from (select sa.SQL_TEXT,
        sa.SQL_FULLTEXT,
        sa.EXECUTIONS "执行次数",
        round(sa.ELAPSED_TIME / 1000000, 2) "总执行时间",
        round(sa.ELAPSED_TIME / 1000000 / sa.EXECUTIONS, 2) "平均执行时间",
        sa.COMMAND_TYPE,
        sa.PARSING_USER_ID "用户ID",
        u.username "用户名",
        sa.HASH_VALUE
     from v$sqlarea sa
     left join all_users u
      on sa.PARSING_USER_ID = u.user_id
     where sa.EXECUTIONS > 0
     order by (sa.ELAPSED_TIME / sa.EXECUTIONS) desc)
 where rownum <= 50;


call dbms_stats.gather_database_stats_job_proc()

```







```sql
Oracle数据库的日期字段自动添加系统时间
//添加Oracle数据库字段是，日期字段自动添加系统时间

insert into 表名 (字段名) values(sysdate)

//建表时，设置为自动添加时间

建表的时候指定默认值即可default sysdate
如: create table t1(d date default sysdate)

//把表中的时间修改成自动添加系统时间

 alter table t1 modify(d default sysdate)
```











