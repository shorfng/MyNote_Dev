> 当前位置：【Java】09_Architecture_Distributed（分布式架构） -> 9.4_Zookeeper（分布式协调服务）



# 第一章 Zookeeper 下载安装和配置

## 0、Zookeeper 下载

- 官网下载：http://zookeeper.apache.org/releases.html
- 历史版本：https://archive.apache.org/dist/zookeeper/



## 1、Docker - Zookeeper 安装和配置

- Docker-Zookeeper 官网地址：https://hub.docker.com/_/zookeeper

  

### 1.1 拉取镜像

```shell
docker pull zookeeper:3.7.0
```



### 1.2 备份镜像

```shell
cd /docker_data/
docker save zookeeper:3.7.0 -o zookeeper:3.7.0.tar
```



### 1.3 导入镜像

```shell
docker load -i zookeeper:3.7.0.tar
```



### 1.4 Linux 创建并运行容器

#### （1）单机版

##### 步骤 1：创建文件夹

```shell
# 创建文件夹
mkdir -p /docker_data/zookeeper-2181/{data,logs,conf}
```



##### 步骤 2：创建 zoo.cfg

- 此文件夹下创建 /docker_data/zookeeper-2181/conf

```properties
# The number of milliseconds of each tick
tickTime=2000

# The number of ticks that the initial 
# synchronization phase can take
initLimit=10

# The number of ticks that can pass between 
# sending a request and getting an acknowledgement
syncLimit=5

# the directory where the snapshot is stored.
# do not use /tmp for storage, /tmp here is just 
# example sakes.
dataDir=/data
dataLogDir=/logs

# the port at which the clients will connect
clientPort=2181

# the maximum number of client connections.
# increase this if you need to handle more clients
#maxClientCnxns=60


# Be sure to read the maintenance section of the 
# administrator guide before turning on autopurge.
#
# http://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance

# The number of snapshots to retain in dataDir
#autopurge.snapRetainCount=3

# Purge task interval in hours
# Set to "0" to disable auto purge feature
#autopurge.purgeInterval=1

## Metrics Providers
#
# https://prometheus.io Metrics Exporter
#metricsProvider.className=org.apache.zookeeper.metrics.prometheus.PrometheusMetricsProvider
#metricsProvider.httpPort=7000
#metricsProvider.exportJvmInfo=true
```



##### 步骤 3：创建容器命令

```bash
cd /docker_data/zookeeper/

docker run -itd --name zookeeper --restart always -p 2181:2181 -v $(pwd)/conf/zoo.cfg:/conf/zoo.cfg  -v $(pwd)/data/:/data/ -v $(pwd)/logs:/logs zookeeper:3.7.0
```



#### （2）集群版 - 创建容器命令

##### 步骤1：创建 docker-compose.yml

```yml
version: '2.1'

services:
  zoo1:
    image: zookeeper
    restart: always
    hostname: zoo1
    volumes:
#      - /docker_data/zookeeper-2181/conf:/conf
      - /docker_data/zookeeper-2181/logs:/logs
      - /docker_data/zookeeper-2181/data:/data
    ports:
      - 2181:2181
    environment:
      ZOO_MY_ID: 1
      ZOO_SERVERS: server.1=0.0.0.0:2888:3888;2181 server.2=zoo2:2888:3888;2181 server.3=zoo3:2888:3888;2181

  zoo2:
    image: zookeeper
    restart: always
    hostname: zoo2
    volumes:
#      - /docker_data/zookeeper-2182/conf:/conf
      - /docker_data/zookeeper-2182/logs:/logs
      - /docker_data/zookeeper-2182/data:/data
    ports:
      - 2182:2181
    environment:
      ZOO_MY_ID: 2
      ZOO_SERVERS: server.1=zoo1:2888:3888;2181 server.2=0.0.0.0:2888:3888;2181 server.3=zoo3:2888:3888;2181

  zoo3:
    image: zookeeper
    restart: always
    hostname: zoo3
    volumes:
#      - /docker_data/zookeeper-2183/conf:/conf
      - /docker_data/zookeeper-2183/logs:/logs
      - /docker_data/zookeeper-2183/data:/data
    ports:
      - 2183:2181
    environment:
      ZOO_MY_ID: 3
      ZOO_SERVERS: server.1=zoo1:2888:3888;2181 server.2=zoo2:2888:3888;2181 server.3=0.0.0.0:2888:3888;2181
```



##### 步骤2：启动 docker-compose.yml

```bash
docker-compose up
```



##### 步骤3：查看集群状态

```bash
# 进入容器

# 切换目录
cd bin

# 查看 zk 状态
./zkServer.sh status
```



### 1.5 Mac 创建并运行容器

#### （1）单机版

##### 步骤 1：创建文件夹

```shell
# 创建文件夹
mkdir -p /Users/td/Documents/03_DevTools/docker_data/zookeeper-2181/{data,logs,conf}
```



##### 步骤 2：创建 zoo.cfg

- 此文件夹下创建 /Users/td/Documents/03_DevTools/docker_data/zookeeper-2181/conf

```properties
# The number of milliseconds of each tick
tickTime=2000

# The number of ticks that the initial 
# synchronization phase can take
initLimit=10

# The number of ticks that can pass between 
# sending a request and getting an acknowledgement
syncLimit=5

# the directory where the snapshot is stored.
# do not use /tmp for storage, /tmp here is just 
# example sakes.
dataDir=/data
dataLogDir=/logs

# the port at which the clients will connect
clientPort=2181

# the maximum number of client connections.
# increase this if you need to handle more clients
#maxClientCnxns=60


# Be sure to read the maintenance section of the 
# administrator guide before turning on autopurge.
#
# http://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance

# The number of snapshots to retain in dataDir
#autopurge.snapRetainCount=3

# Purge task interval in hours
# Set to "0" to disable auto purge feature
#autopurge.purgeInterval=1

## Metrics Providers
#
# https://prometheus.io Metrics Exporter
#metricsProvider.className=org.apache.zookeeper.metrics.prometheus.PrometheusMetricsProvider
#metricsProvider.httpPort=7000
#metricsProvider.exportJvmInfo=true
```



##### 步骤 3：创建容器命令

```bash
cd /Users/td/Documents/03_DevTools/docker_data/zookeeper/

docker run -itd --name zookeeper --restart always -p 2181:2181 -v $(pwd)/conf/zoo.cfg:/conf/zoo.cfg  -v $(pwd)/data/:/data/ -v $(pwd)/logs:/logs zookeeper:3.7.0
```



#### （2）集群版 - 创建容器命令

- TODO



## 2、Linux系统 - Zookeeper 安装和配置

- TODO



## 3、Win系统 - Zookeeper 安装和配置

- TODO



## 4、Mac系统 - Zookeeper 安装和配置

```properties
# The number of milliseconds of each tick
tickTime=10000

# The number of ticks that the initial 
# synchronization phase can take
initLimit=10

# The number of ticks that can pass between 
# sending a request and getting an acknowledgement
syncLimit=5

# the directory where the snapshot is stored.
# do not use /tmp for storage, /tmp here is just 
# example sakes.
dataDir=/Users/td/Documents/03_DevTools/zookeeper-2181/data
dataLogDir=/Users/td/Documents/03_DevTools/zookeeper-2181/logs

# the port at which the clients will connect
clientPort=2181

# the maximum number of client connections.
# increase this if you need to handle more clients
#maxClientCnxns=60


# Be sure to read the maintenance section of the 
# administrator guide before turning on autopurge.
#
# http://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance

# The number of snapshots to retain in dataDir
#autopurge.snapRetainCount=3

# Purge task interval in hours
# Set to "0" to disable auto purge feature
#autopurge.purgeInterval=1

## Metrics Providers
#
# https://prometheus.io Metrics Exporter
#metricsProvider.className=org.apache.zookeeper.metrics.prometheus.PrometheusMetricsProvider
#metricsProvider.httpPort=7000
#metricsProvider.exportJvmInfo=true

# server.服务器ID=服务器IP地址：服务器之间通信端⼝：服务器之间投票选举端⼝
server.1=192.168.137.240:2881:2881
server.2=192.168.137.240:2882:2882
server.3=192.168.137.240:2883:2883
```
