> 当前位置：【Java】13_Tools（工具）-> 13.6_DevOps（运维部署）-> 00_CI和CD



## 1、持续集成（Continuous integration，简称CI）

- 概念

  - 持续集成是一种软件开发实践

  - 持续集成是指频繁地(一天多次)将代码集成到主干

  - 持续集成并不能消除 Bug，而是让它们非常容易发现和改正

- 优点

  - 快速发现错误

    - 每次集成都通过自动化的构建（包括编译，发布，自动化测试）来验证

    - 每完成一点更新，就集成到主干，可以快速发现错误，定位错误也比较容易

  - 防止分支大幅偏离主干
    - 如果不经常集成，主干又在不断更新，会导致以后集成的难度变大，甚至难以集成

- 目的
  - 让产品可以快速迭代，同时还能保持高质量

- 核心措施

  - 代码集成到主干之前，必须通过自动化测试

  - 只要有一个测试用例失败，就不能集成





## 2、持续交付(Continuous delivery)   -  持续集成的下一步

- 概念

  - 频繁地将软件的新版本，交付给质量团队或者用户，以供评审

  - 如果评审通过，代码就进入生产阶段

- 不管怎么更新，软件是随时随地可以交付的



## 3、持续部署(continuous deployment)  -  持续交付的下一步

- 概念

  - 代码通过评审以后，自动部署到生产环境

  - 持续部署的前提是能自动化完成测试、构建、部署等步骤

- 代码在任何时刻都是可部署的，可以进入生产阶段



## 4、流程（代码从提交到生产）

- 提交
  - 向代码仓库提交代码

- 测试（可能只做单元测试）
  - 代码仓库对commit操作配置了钩子（hook），只要提交代码或者合并进主干，就会跑自动化测试

- 构建

  - 构建指的是将源码转换为可以运行的实际代码，比如安装依赖，配置各种资源（样式表、JS脚本、图片）等等

  - 通过第一轮测试，代码就可以合并进主干，就可以交付了

  - 交付后，就先进行构建（build），再进入第二轮测试

- 测试（全面测试，下面3种测试至少做前两种）

  - 单元测试：针对函数或模块的测试

  - 集成测试/功能测试：针对整体产品的某个功能的测试

  - 端对端测试：从用户界面直达数据库的全链路测试

- 部署

  - 通过了第二轮测试，当前代码就是一个可以直接部署的版本（artifact）。将这个版本的所有文件打包（ tar filename.tar * ）存档，发到生产服务器

  - 生产服务器将打包文件，解包成本地的一个目录，再将运行路径的符号链接（symlink）指向这个目录，然后重新启动应用

  - 部署工具有Ansible，Chef，Puppet等

- 回滚
  - 一旦当前版本发生问题，就要回滚到上一个版本的构建结果。最简单的做法就是修改一下符号链接，指向上一个版本的目录





- 参考资料

  - http://www.ruanyifeng.com/blog/2015/09/continuous-integration.html